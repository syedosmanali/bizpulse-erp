{% extends "erp_base_layout.html" %}

{% block title %}Barcode Management - ERP{% endblock %}

{% block extra_css %}
<style>
    :root {
        --wine: #732C3F;
        --wine-light: #8d3a4f;
        --bg: #f8f9fa;
        --text: #1A1A1A;
        --sub: #6B7280;
        --border: #e5e7eb;
        --radius: 12px;
    }

    .page-wrapper { background: var(--bg); min-height: 100vh; padding: 24px 20px; }
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; gap: 16px; }
    .page-header h1 { font-size: 28px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 12px; margin: 0; }
    .page-header h1 i { color: var(--wine); }

    /* Stats Cards */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .stat-card { background: #fff; border-radius: var(--radius); padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 16px; }
    .stat-icon { width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
    .stat-icon.primary { background: rgba(115, 44, 63, 0.1); color: var(--wine); }
    .stat-icon.success { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .stat-icon.info { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
    .stat-info .value { font-size: 24px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
    .stat-info .label { font-size: 13px; color: var(--sub); font-weight: 500; }

    /* Tab Navigation */
    .tab-nav { background: #fff; border-radius: var(--radius); padding: 8px; display: flex; gap: 8px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .tab-btn { flex: 1; padding: 12px 20px; border: none; background: transparent; color: var(--sub); font-size: 15px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .tab-btn:hover { background: #f3f4f6; }
    .tab-btn.active { background: var(--wine); color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Content Card */
    .content-card { background: #fff; border-radius: var(--radius); padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
    .content-header h2 { font-size: 20px; font-weight: 600; color: var(--text); margin: 0; }
    .header-actions { display: flex; gap: 12px; align-items: center; }

    /* Buttons */
    .btn { border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; padding: 10px 20px; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; text-decoration: none; }
    .btn-primary { background: var(--wine); color: #fff; }
    .btn-primary:hover { background: var(--wine-light); }
    .btn-secondary { background: #f3f4f6; color: var(--text); }
    .btn-secondary:hover { background: #e5e7eb; }
    .btn-sm { padding: 6px 12px; font-size: 13px; }

    /* Search Bar */
    .search-bar { width: 100%; max-width: 400px; padding: 10px 16px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 14px; transition: all 0.2s; }
    .search-bar:focus { outline: none; border-color: var(--wine); }

    /* Generator Box */
    .generator-box { background: white; border: 2px solid var(--wine); border-radius: var(--radius); padding: 32px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(115, 44, 63, 0.1); }
    .generator-box h3 { font-size: 20px; margin-bottom: 24px; display: flex; align-items: center; gap: 8px; color: var(--wine); }
    .generator-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .generator-field { display: flex; flex-direction: column; gap: 8px; }
    .generator-field label { font-size: 14px; font-weight: 600; color: var(--text); }
    .generator-field input, .generator-field select { padding: 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 14px; transition: all 0.2s; }
    .generator-field input:focus, .generator-field select:focus { outline: none; border-color: var(--wine); box-shadow: 0 0 0 3px rgba(115, 44, 63, 0.1); }
    .generator-actions { grid-column: 1 / -1; display: flex; gap: 12px; margin-top: 12px; }
    .barcode-preview { grid-column: 1 / -1; background: #f8f9fa; border: 2px dashed var(--border); border-radius: 8px; padding: 24px; text-align: center; min-height: 150px; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 12px; }
    .barcode-preview img { max-width: 300px; height: auto; }
    .barcode-preview .placeholder { color: var(--sub); font-size: 14px; }

    /* Scanner Box */
    .scanner-box { background: #f8f9fa; border: 2px dashed var(--border); border-radius: var(--radius); padding: 32px; text-align: center; margin-bottom: 20px; }
    .scanner-box h3 { font-size: 18px; margin-bottom: 16px; color: var(--text); }
    .scanner-input { width: 100%; max-width: 400px; padding: 14px 20px; border: 2px solid var(--wine); border-radius: 8px; font-size: 16px; text-align: center; font-weight: 600; margin: 0 auto; }
    .scanner-input:focus { outline: none; box-shadow: 0 0 0 3px rgba(115, 44, 63, 0.1); }
    .scan-result { margin-top: 24px; padding: 20px; background: white; border-radius: 8px; display: none; }
    .scan-result.active { display: block; }

    /* Table */
    .data-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    .data-table thead { background: #f8f9fa; }
    .data-table th { padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: var(--sub); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid var(--border); }
    .data-table td { padding: 14px 16px; border-bottom: 1px solid var(--border); font-size: 14px; color: var(--text); }
    .data-table tbody tr:hover { background: #f8f9fa; }

    /* Badges */
    .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    .badge-success { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .badge-info { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }

    /* Action Buttons */
    .action-btns { display: flex; gap: 8px; }
    .icon-btn { width: 32px; height: 32px; border: none; background: #f3f4f6; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .icon-btn:hover { background: var(--wine); color: white; }

    /* Empty State */
    .empty-state { text-align: center; padding: 60px 20px; color: var(--sub); }
    .empty-state i { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state h3 { font-size: 18px; margin-bottom: 8px; color: var(--text); }
    .empty-state p { font-size: 14px; }

    /* Print Settings */
    .print-settings { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
    .setting-group { background: #f8f9fa; padding: 20px; border-radius: 8px; }
    .setting-group h4 { font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--text); }
    .setting-item { margin-bottom: 12px; }
    .setting-item label { display: block; font-size: 13px; color: var(--sub); margin-bottom: 4px; }
    .setting-item input, .setting-item select { width: 100%; padding: 8px 12px; border: 1.5px solid var(--border); border-radius: 6px; font-size: 13px; }

    /* Responsive */
    @media (max-width: 768px) {
        .page-wrapper { padding: 16px 12px; }
        .page-header { flex-direction: column; align-items: flex-start; }
        .tab-nav { flex-direction: column; }
        .stats-grid { grid-template-columns: 1fr; }
        .content-header { flex-direction: column; align-items: flex-start; }
        .search-bar { max-width: 100%; }
        .data-table { font-size: 13px; }
        .data-table th, .data-table td { padding: 10px 12px; }
        .generator-form { grid-template-columns: 1fr; }
        .generator-actions { flex-direction: column; }
        .print-settings { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <!-- Page Header -->
    <div class="page-header">
        <h1><i data-lucide="maximize"></i> Barcode Management</h1>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon primary">
                <i data-lucide="hash"></i>
            </div>
            <div class="stat-info">
                <div class="value" id="totalBarcodes">0</div>
                <div class="label">Total Barcodes</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon success">
                <i data-lucide="check-circle"></i>
            </div>
            <div class="stat-info">
                <div class="value" id="generatedToday">0</div>
                <div class="label">Generated Today</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon info">
                <i data-lucide="scan"></i>
            </div>
            <div class="stat-info">
                <div class="value" id="scannedToday">0</div>
                <div class="label">Scanned Today</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon primary">
                <i data-lucide="package"></i>
            </div>
            <div class="stat-info">
                <div class="value" id="productsWithBarcode">0</div>
                <div class="label">Products with Barcode</div>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-nav">
        <button class="tab-btn active" data-tab="generate">
            <i data-lucide="plus-square"></i>
            Generate
        </button>
        <button class="tab-btn" data-tab="scan">
            <i data-lucide="scan"></i>
            Scan & Lookup
        </button>
        <button class="tab-btn" data-tab="print">
            <i data-lucide="printer"></i>
            Print Labels
        </button>
        <button class="tab-btn" data-tab="manage">
            <i data-lucide="list"></i>
            Manage
        </button>
    </div>

    <!-- Generate Tab -->
    <div class="tab-content active" id="generate-tab">
        <div class="generator-box">
            <h3><i data-lucide="zap"></i> Barcode Generator</h3>
            <div class="generator-form">
                <div class="generator-field">
                    <label>Product *</label>
                    <select id="genProduct">
                        <option value="">Select Product</option>
                        <option value="1">Product 1</option>
                        <option value="2">Product 2</option>
                    </select>
                </div>
                <div class="generator-field">
                    <label>Barcode Format *</label>
                    <select id="genFormat">
                        <option value="EAN-13">EAN-13 (Standard)</option>
                        <option value="CODE-128">Code-128</option>
                        <option value="UPC-A">UPC-A</option>
                        <option value="QR">QR Code</option>
                    </select>
                </div>
                <div class="generator-field">
                    <label>Barcode Number</label>
                    <input type="text" id="genBarcode" placeholder="Auto-generate or enter manually">
                </div>
                <div class="generator-field">
                    <label>Quantity</label>
                    <input type="number" id="genQuantity" value="1" min="1" max="1000">
                </div>
                
                <div class="barcode-preview" id="barcodePreview">
                    <div class="placeholder">
                        <i data-lucide="image" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                        <p>Barcode preview will appear here</p>
                    </div>
                </div>
                
                <div class="generator-actions">
                    <button class="btn btn-secondary" onclick="generateBarcode()" style="flex: 1;">
                        <i data-lucide="refresh-cw"></i>
                        Generate Barcode
                    </button>
                    <button class="btn btn-primary" onclick="saveBarcode()" style="flex: 1;">
                        <i data-lucide="save"></i>
                        Save & Print
                    </button>
                </div>
            </div>
        </div>

        <!-- Bulk Generation -->
        <div class="content-card">
            <div class="content-header">
                <h2>Bulk Generation</h2>
                <button class="btn btn-secondary" onclick="openBulkModal()">
                    <i data-lucide="layers"></i>
                    Generate for Multiple Products
                </button>
            </div>
            <p style="color: var(--sub); font-size: 14px;">Generate barcodes for multiple products at once. Select products and format to create barcodes in bulk.</p>
        </div>
    </div>

    <!-- Scan & Lookup Tab -->
    <div class="tab-content" id="scan-tab">
        <div class="scanner-box">
            <h3><i data-lucide="scan"></i> Scan Barcode</h3>
            <p style="color: var(--sub); margin-bottom: 20px;">Use a barcode scanner or enter barcode manually</p>
            <input type="text" class="scanner-input" id="scanInput" placeholder="Scan or type barcode here..." autofocus>
            
            <div class="scan-result" id="scanResult">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left;">
                    <div>
                        <p style="font-size: 12px; color: var(--sub); margin-bottom: 4px;">Product Name</p>
                        <p style="font-size: 16px; font-weight: 600;" id="resultName">-</p>
                    </div>
                    <div>
                        <p style="font-size: 12px; color: var(--sub); margin-bottom: 4px;">Product Code</p>
                        <p style="font-size: 16px; font-weight: 600;" id="resultCode">-</p>
                    </div>
                    <div>
                        <p style="font-size: 12px; color: var(--sub); margin-bottom: 4px;">Price</p>
                        <p style="font-size: 16px; font-weight: 600; color: var(--wine);" id="resultPrice">-</p>
                    </div>
                    <div>
                        <p style="font-size: 12px; color: var(--sub); margin-bottom: 4px;">Stock</p>
                        <p style="font-size: 16px; font-weight: 600;" id="resultStock">-</p>
                    </div>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="viewProductDetails()">
                        <i data-lucide="eye"></i>
                        View Details
                    </button>
                    <button class="btn btn-primary" onclick="addToCart()">
                        <i data-lucide="shopping-cart"></i>
                        Add to Cart
                    </button>
                </div>
            </div>
        </div>

        <!-- Recent Scans -->
        <div class="content-card">
            <div class="content-header">
                <h2>Recent Scans</h2>
                <button class="btn btn-secondary" onclick="clearScanHistory()">
                    <i data-lucide="trash-2"></i>
                    Clear History
                </button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Barcode</th>
                        <th>Product</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="scanHistoryBody">
                    <tr>
                        <td colspan="4">
                            <div class="empty-state">
                                <i data-lucide="inbox"></i>
                                <h3>No Scan History</h3>
                                <p>Start scanning barcodes to see history</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Print Labels Tab -->
    <div class="tab-content" id="print-tab">
        <div class="content-card">
            <div class="content-header">
                <h2>Print Barcode Labels</h2>
                <button class="btn btn-primary" onclick="printLabels()">
                    <i data-lucide="printer"></i>
                    Print Selected
                </button>
            </div>

            <div class="print-settings">
                <div class="setting-group">
                    <h4>Label Size</h4>
                    <div class="setting-item">
                        <label>Width (mm)</label>
                        <input type="number" id="labelWidth" value="50" min="20" max="100">
                    </div>
                    <div class="setting-item">
                        <label>Height (mm)</label>
                        <input type="number" id="labelHeight" value="30" min="15" max="80">
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Label Content</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="showProductName" checked style="margin-right: 8px;">
                            Show Product Name
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="showPrice" checked style="margin-right: 8px;">
                            Show Price
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="showCode" style="margin-right: 8px;">
                            Show Product Code
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Print Options</h4>
                    <div class="setting-item">
                        <label>Labels per Row</label>
                        <select id="labelsPerRow">
                            <option value="1">1</option>
                            <option value="2" selected>2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Copies</label>
                        <input type="number" id="printCopies" value="1" min="1" max="100">
                    </div>
                </div>
            </div>

            <table class="data-table" style="margin-top: 24px;">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAllPrint" onchange="toggleSelectAllPrint()"></th>
                        <th>Product</th>
                        <th>Barcode</th>
                        <th>Format</th>
                        <th>Preview</th>
                    </tr>
                </thead>
                <tbody id="printTableBody">
                    <tr>
                        <td colspan="5">
                            <div class="empty-state">
                                <i data-lucide="printer"></i>
                                <h3>No Products Selected</h3>
                                <p>Generate barcodes first to print labels</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Manage Tab -->
    <div class="tab-content" id="manage-tab">
        <div class="content-card">
            <div class="content-header">
                <h2>All Barcodes</h2>
                <div class="header-actions">
                    <input type="text" class="search-bar" id="searchBarcodes" placeholder="Search barcodes...">
                    <button class="btn btn-secondary" onclick="loadBarcodes()">
                        <i data-lucide="refresh-cw"></i>
                        Refresh
                    </button>
                    <button class="btn btn-primary" onclick="exportBarcodes()">
                        <i data-lucide="download"></i>
                        Export
                    </button>
                </div>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Barcode</th>
                        <th>Product</th>
                        <th>Format</th>
                        <th>Generated Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="barcodesTableBody">
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <i data-lucide="inbox"></i>
                                <h3>No Barcodes Yet</h3>
                                <p>Generate your first barcode to get started</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
let barcodes = [];
let scanHistory = [];

// Tab Switching
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const tab = btn.dataset.tab;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`${tab}-tab`).classList.add('active');
        lucide.createIcons();
    });
});

// Generate Barcode
function generateBarcode() {
    const product = document.getElementById('genProduct').value;
    const format = document.getElementById('genFormat').value;
    
    if (!product) {
        alert('Please select a product');
        return;
    }
    
    // Generate random barcode number
    const barcodeNumber = Math.floor(Math.random() * 9000000000000) + 1000000000000;
    document.getElementById('genBarcode').value = barcodeNumber;
    
    // Show preview (mock)
    const preview = document.getElementById('barcodePreview');
    preview.innerHTML = `
        <div style="padding: 20px; background: white; border-radius: 8px;">
            <div style="font-family: 'Libre Barcode 128', cursive; font-size: 48px; color: black; letter-spacing: 2px;">
                *${barcodeNumber}*
            </div>
            <div style="font-size: 14px; color: var(--text); margin-top: 8px; font-weight: 600;">
                ${barcodeNumber}
            </div>
            <div style="font-size: 12px; color: var(--sub); margin-top: 4px;">
                Format: ${format}
            </div>
        </div>
    `;
    
    lucide.createIcons();
}

async function saveBarcode() {
    const product = document.getElementById('genProduct').value;
    const format = document.getElementById('genFormat').value;
    const barcode = document.getElementById('genBarcode').value;
    const quantity = document.getElementById('genQuantity').value;
    
    if (!product || !barcode) {
        alert('Please generate a barcode first');
        return;
    }
    
    try {
        const response = await fetch(`/api/erp/products/${product}/barcode`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ format, barcode, quantity })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Barcode saved successfully!');
            loadBarcodes();
            // Reset form
            document.getElementById('genProduct').value = '';
            document.getElementById('genBarcode').value = '';
            document.getElementById('barcodePreview').innerHTML = `
                <div class="placeholder">
                    <i data-lucide="image" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
                    <p>Barcode preview will appear here</p>
                </div>
            `;
            lucide.createIcons();
        } else {
            alert(data.error || 'Failed to save barcode');
        }
    } catch (error) {
        console.error('Error saving barcode:', error);
        alert('Failed to save barcode');
    }
}

// Scan Barcode
document.getElementById('scanInput').addEventListener('keypress', async function(e) {
    if (e.key === 'Enter') {
        const barcode = this.value.trim();
        if (!barcode) return;
        
        try {
            const response = await fetch(`/api/erp/products/barcode/${barcode}`);
            const data = await response.json();
            
            if (data.success) {
                const product = data.data;
                document.getElementById('resultName').textContent = product.product_name || '-';
                document.getElementById('resultCode').textContent = product.product_code || '-';
                document.getElementById('resultPrice').textContent = product.selling_price ? `â‚¹${product.selling_price}` : '-';
                document.getElementById('resultStock').textContent = product.current_stock || '0';
                document.getElementById('scanResult').classList.add('active');
                
                // Add to scan history
                scanHistory.unshift({
                    time: new Date().toLocaleTimeString(),
                    barcode: barcode,
                    product: product.product_name
                });
                renderScanHistory();
            } else {
                alert('Product not found for this barcode');
                document.getElementById('scanResult').classList.remove('active');
            }
        } catch (error) {
            console.error('Error scanning barcode:', error);
            alert('Failed to scan barcode');
        }
        
        this.value = '';
    }
});

function renderScanHistory() {
    const tbody = document.getElementById('scanHistoryBody');
    
    if (scanHistory.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="4">
                    <div class="empty-state">
                        <i data-lucide="inbox"></i>
                        <h3>No Scan History</h3>
                        <p>Start scanning barcodes to see history</p>
                    </div>
                </td>
            </tr>
        `;
    } else {
        tbody.innerHTML = scanHistory.slice(0, 10).map(scan => `
            <tr>
                <td>${scan.time}</td>
                <td><strong>${scan.barcode}</strong></td>
                <td>${scan.product}</td>
                <td>
                    <button class="btn btn-sm btn-secondary" onclick="rescanBarcode('${scan.barcode}')">
                        <i data-lucide="repeat"></i>
                        Rescan
                    </button>
                </td>
            </tr>
        `).join('');
    }
    
    lucide.createIcons();
}

function clearScanHistory() {
    if (!confirm('Clear all scan history?')) return;
    scanHistory = [];
    renderScanHistory();
}

function viewProductDetails() {
    alert('View product details - to be implemented');
}

function addToCart() {
    alert('Add to cart - to be implemented');
}

function rescanBarcode(barcode) {
    document.getElementById('scanInput').value = barcode;
    document.getElementById('scanInput').dispatchEvent(new KeyboardEvent('keypress', { key: 'Enter' }));
}

// Load Barcodes
async function loadBarcodes() {
    try {
        // Mock data - replace with actual API call
        barcodes = [
            { id: 1, barcode: '1234567890123', product: 'Product 1', format: 'EAN-13', date: '2024-01-15', status: 'Active' },
            { id: 2, barcode: '9876543210987', product: 'Product 2', format: 'CODE-128', date: '2024-01-14', status: 'Active' }
        ];
        
        renderBarcodes();
        updateStats();
    } catch (error) {
        console.error('Error loading barcodes:', error);
    }
}

function renderBarcodes() {
    const tbody = document.getElementById('barcodesTableBody');
    
    if (barcodes.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="6">
                    <div class="empty-state">
                        <i data-lucide="inbox"></i>
                        <h3>No Barcodes Yet</h3>
                        <p>Generate your first barcode to get started</p>
                    </div>
                </td>
            </tr>
        `;
    } else {
        tbody.innerHTML = barcodes.map(barcode => `
            <tr>
                <td><strong>${barcode.barcode}</strong></td>
                <td>${barcode.product}</td>
                <td><span class="badge badge-info">${barcode.format}</span></td>
                <td>${barcode.date}</td>
                <td><span class="badge badge-success">${barcode.status}</span></td>
                <td>
                    <div class="action-btns">
                        <button class="icon-btn" onclick="printSingleBarcode('${barcode.id}')" title="Print">
                            <i data-lucide="printer"></i>
                        </button>
                        <button class="icon-btn" onclick="deleteBarcode('${barcode.id}')" title="Delete">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `).join('');
    }
    
    lucide.createIcons();
}

function updateStats() {
    document.getElementById('totalBarcodes').textContent = barcodes.length;
    document.getElementById('generatedToday').textContent = '5';
    document.getElementById('scannedToday').textContent = scanHistory.length;
    document.getElementById('productsWithBarcode').textContent = barcodes.length;
}

function toggleSelectAllPrint() {
    const checked = document.getElementById('selectAllPrint').checked;
    document.querySelectorAll('.print-check').forEach(cb => cb.checked = checked);
}

function printLabels() {
    alert('Print labels functionality - to be implemented');
}

function printSingleBarcode(id) {
    alert(`Print barcode ${id}`);
}

function deleteBarcode(id) {
    if (!confirm('Delete this barcode?')) return;
    barcodes = barcodes.filter(b => b.id != id);
    renderBarcodes();
    updateStats();
}

function exportBarcodes() {
    alert('Export barcodes to CSV - to be implemented');
}

function openBulkModal() {
    alert('Bulk generation modal - to be implemented');
}

// Search Functionality
document.getElementById('searchBarcodes').addEventListener('input', (e) => {
    const search = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#barcodesTableBody tr');
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(search) ? '' : 'none';
    });
});

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadBarcodes();
    lucide.createIcons();
});
</script>
{% endblock %}
