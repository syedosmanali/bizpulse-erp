<!DOCTYPE html>
<html>
<head>
    <title>Test Sales API</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #007bff; color: white; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Sales API Test Page</h1>
        
        <div id="status"></div>
        
        <div>
            <button onclick="testAPI()">Test Sales API</button>
            <button onclick="testSummary()">Test Summary API</button>
            <button onclick="location.href='/retail/sales'">Go to Sales Page</button>
        </div>
        
        <h2>Results:</h2>
        <div id="results"></div>
        
        <h2>Raw Response:</h2>
        <pre id="rawResponse"></pre>
    </div>
    
    <script>
        async function testAPI() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            const rawDiv = document.getElementById('rawResponse');
            
            try {
                statusDiv.innerHTML = '<div class="status info">üîÑ Testing /api/sales/all...</div>';
                
                const response = await fetch('/api/sales/all?filter=today&category=all&payment_method=all&limit=100');
                const data = await response.json();
                
                rawDiv.textContent = JSON.stringify(data, null, 2);
                
                if (data.success) {
                    statusDiv.innerHTML = '<div class="status success">‚úÖ API Working! Found ' + data.sales.length + ' sales</div>';
                    
                    let html = '<table><thead><tr><th>S.No</th><th>Bill #</th><th>Customer</th><th>Amount</th><th>Date</th><th>Payment</th></tr></thead><tbody>';
                    
                    data.sales.forEach((sale, index) => {
                        html += `<tr>
                            <td>${index + 1}</td>
                            <td>${sale.bill_number}</td>
                            <td>${sale.customer_name}</td>
                            <td>‚Çπ${sale.total_amount}</td>
                            <td>${sale.sale_date}</td>
                            <td>${sale.payment_method}</td>
                        </tr>`;
                    });
                    
                    html += '</tbody></table>';
                    
                    html += `<div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 4px;">
                        <h3>Summary:</h3>
                        <p><strong>Total Sales:</strong> ${data.summary.total_bills}</p>
                        <p><strong>Total Revenue:</strong> ‚Çπ${data.summary.total_revenue}</p>
                        <p><strong>Total Items:</strong> ${data.summary.total_items}</p>
                    </div>`;
                    
                    resultsDiv.innerHTML = html;
                } else {
                    statusDiv.innerHTML = '<div class="status error">‚ùå API returned success=false</div>';
                    resultsDiv.innerHTML = '<p>Error: ' + (data.error || 'Unknown error') + '</p>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Error: ' + error.message + '</div>';
                resultsDiv.innerHTML = '<p>Failed to fetch data</p>';
                rawDiv.textContent = error.toString();
            }
        }
        
        async function testSummary() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            const rawDiv = document.getElementById('rawResponse');
            
            try {
                statusDiv.innerHTML = '<div class="status info">üîÑ Testing /api/sales/summary...</div>';
                
                const response = await fetch('/api/sales/summary?date_filter=today');
                const data = await response.json();
                
                rawDiv.textContent = JSON.stringify(data, null, 2);
                
                if (data.success) {
                    statusDiv.innerHTML = '<div class="status success">‚úÖ Summary API Working!</div>';
                    
                    resultsDiv.innerHTML = `
                        <div style="padding: 15px; background: #e7f3ff; border-radius: 4px;">
                            <h3>Today's Summary:</h3>
                            <p><strong>Total Sales:</strong> ${data.summary.total_sales}</p>
                            <p><strong>Total Revenue:</strong> ‚Çπ${data.summary.total_revenue}</p>
                            <p><strong>Total Items:</strong> ${data.summary.total_items}</p>
                            <p><strong>Average Sale:</strong> ‚Çπ${data.summary.avg_sale_value}</p>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = '<div class="status error">‚ùå Summary API returned success=false</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Error: ' + error.message + '</div>';
                rawDiv.textContent = error.toString();
            }
        }
        
        // Auto-test on load
        window.onload = () => {
            testAPI();
        };
    </script>
</body>
</html>
