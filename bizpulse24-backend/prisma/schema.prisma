// Prisma schema for BizPulse24 ERP Backend
// Database: Supabase PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Company table
model Company {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @db.VarChar(255)
  gstin     String?  @unique @db.VarChar(15)
  pan       String?  @db.VarChar(10)
  address   String?  @db.Text
  city      String?  @db.VarChar(100)
  state     String?  @db.VarChar(100)
  pincode   String?  @db.VarChar(10)
  phone     String?  @db.VarChar(20)
  email     String?  @db.VarChar(255)
  logoUrl   String?  @map("logo_url") @db.Text
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy String?  @map("created_by") @db.Uuid
  updatedBy String?  @map("updated_by") @db.Uuid

  userRoles      UserRole[]
  financialYears FinancialYear[]
  categories     Category[]
  brands         Brand[]
  products       Product[]
  locations      Location[]
  stock          Stock[]
  stockLedger    StockLedger[]
  stockAlerts    StockAlert[]
  customers      Customer[]
  vendors        Vendor[]
  customerDues   CustomerDue[]
  vendorPayables VendorPayable[]
  salesInvoices  SalesInvoice[]
  purchaseInvoices PurchaseInvoice[]
  customerPayments CustomerPayment[]
  vendorPayments VendorPayment[]
  gstr1Summaries GSTR1Summary[]

  @@map("companies")
}

// Financial Years table
model FinancialYear {
  id        String   @id @default(uuid()) @db.Uuid
  companyId String   @map("company_id") @db.Uuid
  name      String   @db.VarChar(50)
  startDate DateTime @map("start_date") @db.Date
  endDate   DateTime @map("end_date") @db.Date
  isLocked  Boolean  @default(false) @map("is_locked")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy String?  @map("created_by") @db.Uuid
  updatedBy String?  @map("updated_by") @db.Uuid

  company Company @relation(fields: [companyId], references: [id])

  @@map("financial_years")
}

// User roles table for RBAC
model UserRole {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  companyId String   @map("company_id") @db.Uuid
  role      String   @db.VarChar(20)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  company Company @relation(fields: [companyId], references: [id])

  @@unique([userId, companyId])
  @@index([userId])
  @@index([companyId])
  @@map("user_roles")
}

// Inventory Module Models

// Categories table
model Category {
  id          String     @id @default(uuid()) @db.Uuid
  name        String     @db.VarChar(100)
  description String?    @db.Text
  parentId    String?    @map("parent_id") @db.Uuid
  companyId   String     @map("company_id") @db.Uuid
  isActive    Boolean    @default(true) @map("is_active")
  createdAt   DateTime   @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime   @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy   String?    @map("created_by") @db.Uuid
  updatedBy   String?    @map("updated_by") @db.Uuid

  company   Company   @relation(fields: [companyId], references: [id])
  parent    Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children  Category[] @relation("CategoryHierarchy")
  products  Product[]

  @@unique([name, companyId], name: "uk_categories_name_company")
  @@map("categories")
}

// Brands table
model Brand {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @db.VarChar(100)
  description String?  @db.Text
  companyId   String   @map("company_id") @db.Uuid
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy   String?  @map("created_by") @db.Uuid
  updatedBy   String?  @map("updated_by") @db.Uuid

  company  Company  @relation(fields: [companyId], references: [id])
  products Product[]

  @@unique([name, companyId], name: "uk_brands_name_company")
  @@map("brands")
}

// Products table
model Product {
  id                String    @id @default(uuid()) @db.Uuid
  sku               String    @db.VarChar(50)
  barcode           String?   @db.VarChar(50)
  name              String    @db.VarChar(255)
  description       String?   @db.Text
  categoryId        String?   @map("category_id") @db.Uuid
  brandId           String?   @map("brand_id") @db.Uuid
  hsnCode           String?   @map("hsn_code") @db.VarChar(8)
  gstRate           Decimal   @default(18.00) @map("gst_rate") @db.Decimal(5, 2)
  unit              String    @default("PCS") @db.VarChar(20)
  costPrice         Decimal   @default(0.00) @map("cost_price") @db.Decimal(10, 2)
  sellingPrice      Decimal   @map("selling_price") @db.Decimal(10, 2)
  mrp               Decimal?  @db.Decimal(10, 2)
  minStockLevel     Int       @default(10) @map("min_stock_level")
  maxStockLevel     Int?      @map("max_stock_level")
  reorderLevel      Int?      @map("reorder_level")
  hasBatchTracking  Boolean   @default(false) @map("has_batch_tracking")
  hasExpiryTracking Boolean   @default(false) @map("has_expiry_tracking")
  isActive          Boolean   @default(true) @map("is_active")
  companyId         String    @map("company_id") @db.Uuid
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy         String?   @map("created_by") @db.Uuid
  updatedBy         String?   @map("updated_by") @db.Uuid

  company     Company     @relation(fields: [companyId], references: [id])
  category    Category?   @relation(fields: [categoryId], references: [id])
  brand       Brand?      @relation(fields: [brandId], references: [id])
  stock       Stock[]
  stockLedger StockLedger[]
  stockAlerts StockAlert[]
  salesInvoiceItems SalesInvoiceItem[]
  purchaseInvoiceItems PurchaseInvoiceItem[]

  @@unique([sku, companyId], name: "uk_products_sku_company")
  @@unique([barcode, companyId], name: "uk_products_barcode_company")
  @@index([categoryId], name: "idx_products_category")
  @@index([brandId], name: "idx_products_brand")
  @@index([hsnCode], name: "idx_products_hsn")
  @@map("products")
}

// Locations/Warehouses table
model Location {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @db.VarChar(100)
  code        String   @db.VarChar(20)
  address     String?  @db.Text
  city        String?  @db.VarChar(100)
  state       String?  @db.VarChar(100)
  pincode     String?  @db.VarChar(10)
  isDefault   Boolean  @default(false) @map("is_default")
  companyId   String   @map("company_id") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy   String?  @map("created_by") @db.Uuid
  updatedBy   String?  @map("updated_by") @db.Uuid

  company     Company     @relation(fields: [companyId], references: [id])
  stock       Stock[]
  stockLedger StockLedger[]
  stockAlerts StockAlert[]

  @@unique([code, companyId], name: "uk_locations_code_company")
  @@unique([name, companyId], name: "uk_locations_name_company")
  @@map("locations")
}

// Stock table - current stock levels
model Stock {
  id               String   @id @default(uuid()) @db.Uuid
  productId        String   @map("product_id") @db.Uuid
  locationId       String   @map("location_id") @db.Uuid
  batchNumber      String?  @map("batch_number") @db.VarChar(50)
  expiryDate       DateTime? @map("expiry_date") @db.Date
  quantity         Decimal  @default(0.000) @db.Decimal(10, 3)
  reservedQuantity Decimal  @default(0.000) @map("reserved_quantity") @db.Decimal(10, 3)
  availableQuantity Decimal @default(0.000) @map("available_quantity") @db.Decimal(10, 3)
  averageCost      Decimal  @default(0.00) @map("average_cost") @db.Decimal(10, 2)
  lastUpdated      DateTime @default(now()) @map("last_updated") @db.Timestamp(6)
  companyId        String   @map("company_id") @db.Uuid
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy        String?  @map("created_by") @db.Uuid
  updatedBy        String?  @map("updated_by") @db.Uuid

  product   Product  @relation(fields: [productId], references: [id])
  location  Location @relation(fields: [locationId], references: [id])
  company   Company  @relation(fields: [companyId], references: [id])

  @@unique([productId, locationId, batchNumber], name: "uk_stock_product_location_batch")
  @@map("stock")
}

// Stock Ledger table - detailed movement history
model StockLedger {
  id             String   @id @default(uuid()) @db.Uuid
  productId      String   @map("product_id") @db.Uuid
  locationId     String   @map("location_id") @db.Uuid
  movementType   String   @map("movement_type") @db.VarChar(20)
  quantity       Decimal  @db.Decimal(10, 3)
  batchNumber    String?  @map("batch_number") @db.VarChar(50)
  expiryDate     DateTime? @map("expiry_date") @db.Date
  referenceType  String   @map("reference_type") @db.VarChar(50)
  referenceId    String   @map("reference_id") @db.Uuid
  remarks        String?  @db.Text
  runningBalance Decimal  @map("running_balance") @db.Decimal(10, 3)
  companyId      String   @map("company_id") @db.Uuid
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  createdBy      String?  @map("created_by") @db.Uuid

  product  Product  @relation(fields: [productId], references: [id])
  location Location @relation(fields: [locationId], references: [id])
  company  Company  @relation(fields: [companyId], references: [id])

  @@index([createdAt], name: "idx_stock_ledger_date")
  @@map("stock_ledger")
}

// Stock Alerts table
model StockAlert {
  id              String   @id @default(uuid()) @db.Uuid
  productId       String   @map("product_id") @db.Uuid
  locationId      String   @map("location_id") @db.Uuid
  alertType       String   @map("alert_type") @db.VarChar(20)
  currentStock    Decimal? @map("current_stock") @db.Decimal(10, 3)
  threshold       Decimal? @db.Decimal(10, 3)
  batchNumber     String?  @map("batch_number") @db.VarChar(50)
  expiryDate      DateTime? @map("expiry_date") @db.Date
  message         String?  @db.Text
  isAcknowledged  Boolean  @default(false) @map("is_acknowledged")
  acknowledgedBy  String?  @map("acknowledged_by") @db.Uuid
  acknowledgedAt  DateTime? @map("acknowledged_at") @db.Timestamp(6)
  companyId       String   @map("company_id") @db.Uuid
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  product  Product  @relation(fields: [productId], references: [id])
  location Location @relation(fields: [locationId], references: [id])
  company  Company  @relation(fields: [companyId], references: [id])

  @@index([isAcknowledged], name: "idx_stock_alerts_unacknowledged") @filter(isAcknowledged == false)
  @@map("stock_alerts")
}

// Party Module Models

// Customers table
model Customer {
  id                String        @id @default(uuid()) @db.Uuid
  companyId         String        @map("company_id") @db.Uuid
  customerCode      String        @map("customer_code") @db.VarChar(50)
  companyName       String        @map("company_name") @db.VarChar(255)
  contactPerson     String?       @map("contact_person") @db.VarChar(100)
  gstin             String?       @db.VarChar(15)
  pan               String?       @db.VarChar(10)
  email             String?       @db.VarChar(255)
  phone             String?       @db.VarChar(20)
  mobile            String?       @db.VarChar(20)
  address           String?       @db.Text
  city              String?       @db.VarChar(100)
  state             String?       @db.VarChar(100)
  pincode           String?       @db.VarChar(10)
  country           String        @default("India") @db.VarChar(100)
  creditLimit       Decimal       @default(0.00) @map("credit_limit") @db.Decimal(12, 2)
  creditDays        Int           @default(0) @map("credit_days")
  openingBalance    Decimal       @default(0.00) @map("opening_balance") @db.Decimal(12, 2)
  openingBalanceType String       @default("DEBIT") @map("opening_balance_type") @db.VarChar(10)
  isActive          Boolean       @default(true) @map("is_active")
  createdAt         DateTime      @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime      @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy         String?       @map("created_by") @db.Uuid
  updatedBy         String?       @map("updated_by") @db.Uuid

  company      Company       @relation(fields: [companyId], references: [id])
  customerDues CustomerDue[]
  salesInvoices SalesInvoice[]
  customerPayments CustomerPayment[]

  @@unique([customerCode, companyId], name: "uk_customers_code_company")
  @@unique([gstin, companyId], name: "uk_customers_gstin_company")
  @@unique([pan, companyId], name: "uk_customers_pan_company")
  @@map("customers")
}

// Vendors table
model Vendor {
  id                String        @id @default(uuid()) @db.Uuid
  companyId         String        @map("company_id") @db.Uuid
  vendorCode        String        @map("vendor_code") @db.VarChar(50)
  companyName       String        @map("company_name") @db.VarChar(255)
  contactPerson     String?       @map("contact_person") @db.VarChar(100)
  gstin             String?       @db.VarChar(15)
  pan               String?       @db.VarChar(10)
  email             String?       @db.VarChar(255)
  phone             String?       @db.VarChar(20)
  mobile            String?       @db.VarChar(20)
  address           String?       @db.Text
  city              String?       @db.VarChar(100)
  state             String?       @db.VarChar(100)
  pincode           String?       @db.VarChar(10)
  country           String        @default("India") @db.VarChar(100)
  paymentTerms      Int           @default(0) @map("payment_terms")
  openingBalance    Decimal       @default(0.00) @map("opening_balance") @db.Decimal(12, 2)
  openingBalanceType String       @default("CREDIT") @map("opening_balance_type") @db.VarChar(10)
  isActive          Boolean       @default(true) @map("is_active")
  createdAt         DateTime      @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime      @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy         String?       @map("created_by") @db.Uuid
  updatedBy         String?       @map("updated_by") @db.Uuid

  company       Company        @relation(fields: [companyId], references: [id])
  vendorPayables VendorPayable[]
  purchaseInvoices PurchaseInvoice[]
  vendorPayments VendorPayment[]

  @@unique([vendorCode, companyId], name: "uk_vendors_code_company")
  @@unique([gstin, companyId], name: "uk_vendors_gstin_company")
  @@unique([pan, companyId], name: "uk_vendors_pan_company")
  @@map("vendors")
}

// Customer Dues table
model CustomerDue {
  id               String   @id @default(uuid()) @db.Uuid
  customerId       String   @map("customer_id") @db.Uuid
  companyId        String   @map("company_id") @db.Uuid
  totalSales       Decimal  @default(0.00) @map("total_sales") @db.Decimal(12, 2)
  totalPayments    Decimal  @default(0.00) @map("total_payments") @db.Decimal(12, 2)
  outstandingAmount Decimal @default(0.00) @map("outstanding_amount") @db.Decimal(12, 2)
  lastUpdated      DateTime @default(now()) @map("last_updated") @db.Timestamp(6)
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  customer Customer @relation(fields: [customerId], references: [id])
  company  Company @relation(fields: [companyId], references: [id])

  @@unique([customerId, companyId], name: "uk_customer_dues_customer_company")
  @@map("customer_dues")
}

// Vendor Payables table
model VendorPayable {
  id             String   @id @default(uuid()) @db.Uuid
  vendorId       String   @map("vendor_id") @db.Uuid
  companyId      String   @map("company_id") @db.Uuid
  totalPurchases Decimal  @default(0.00) @map("total_purchases") @db.Decimal(12, 2)
  totalPayments  Decimal  @default(0.00) @map("total_payments") @db.Decimal(12, 2)
  payableAmount  Decimal  @default(0.00) @map("payable_amount") @db.Decimal(12, 2)
  lastUpdated    DateTime @default(now()) @map("last_updated") @db.Timestamp(6)
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  vendor  Vendor  @relation(fields: [vendorId], references: [id])
  company Company @relation(fields: [companyId], references: [id])

  @@unique([vendorId, companyId], name: "uk_vendor_payables_vendor_company")
  @@map("vendor_payables")
}

// Billing Module Models

// Sales Invoices table
model SalesInvoice {
  id                String           @id @default(uuid()) @db.Uuid
  companyId         String           @map("company_id") @db.Uuid
  invoiceNumber     String           @map("invoice_number") @db.VarChar(50)
  invoiceDate       DateTime         @map("invoice_date") @db.Date
  dueDate           DateTime?        @map("due_date") @db.Date
  customerId        String           @map("customer_id") @db.Uuid
  customerGstin     String?          @map("customer_gstin") @db.VarChar(15)
  billingAddress    String?          @map("billing_address") @db.Text
  shippingAddress   String?          @map("shipping_address") @db.Text
  placeOfSupply     String?          @map("place_of_supply") @db.VarChar(100)
  invoiceType       String           @default("TAX_INVOICE") @map("invoice_type") @db.VarChar(20)
  paymentStatus     String           @default("PENDING") @map("payment_status") @db.VarChar(20)
  subtotal          Decimal          @default(0.00) @db.Decimal(12, 2)
  discountAmount    Decimal          @default(0.00) @map("discount_amount") @db.Decimal(12, 2)
  taxAmount         Decimal          @default(0.00) @map("tax_amount") @db.Decimal(12, 2)
  totalAmount       Decimal          @default(0.00) @map("total_amount") @db.Decimal(12, 2)
  roundOff          Decimal          @default(0.00) @map("round_off") @db.Decimal(12, 2)
  grandTotal        Decimal          @default(0.00) @map("grand_total") @db.Decimal(12, 2)
  cgstAmount        Decimal          @default(0.00) @map("cgst_amount") @db.Decimal(12, 2)
  sgstAmount        Decimal          @default(0.00) @map("sgst_amount") @db.Decimal(12, 2)
  igstAmount        Decimal          @default(0.00) @map("igst_amount") @db.Decimal(12, 2)
  cessAmount        Decimal          @default(0.00) @map("cess_amount") @db.Decimal(12, 2)
  isCancelled       Boolean          @default(false) @map("is_cancelled")
  cancelledAt       DateTime?        @map("cancelled_at") @db.Timestamp(6)
  cancelledBy       String?          @map("cancelled_by") @db.Uuid
  cancellationReason String?         @map("cancellation_reason") @db.Text
  notes             String?          @db.Text
  termsAndConditions String?         @map("terms_and_conditions") @db.Text
  createdAt         DateTime         @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime         @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy         String?          @map("created_by") @db.Uuid
  updatedBy         String?          @map("updated_by") @db.Uuid

  company          Company           @relation(fields: [companyId], references: [id])
  customer         Customer          @relation(fields: [customerId], references: [id])
  salesInvoiceItems SalesInvoiceItem[]
  invoicePayments  InvoicePayment[]

  @@unique([invoiceNumber, companyId], name: "uk_sales_invoices_number_company")
  @@map("sales_invoices")
}

// Sales Invoice Items table
model SalesInvoiceItem {
  id             String   @id @default(uuid()) @db.Uuid
  invoiceId      String   @map("invoice_id") @db.Uuid
  productId      String   @map("product_id") @db.Uuid
  hsnCode        String?  @map("hsn_code") @db.VarChar(8)
  description    String?  @db.Text
  quantity       Decimal  @db.Decimal(10, 3)
  unit           String   @default("PCS") @db.VarChar(20)
  unitPrice      Decimal  @map("unit_price") @db.Decimal(12, 2)
  discountPercent Decimal @default(0.00) @map("discount_percent") @db.Decimal(5, 2)
  discountAmount Decimal @default(0.00) @map("discount_amount") @db.Decimal(12, 2)
  taxableAmount  Decimal @default(0.00) @map("taxable_amount") @db.Decimal(12, 2)
  gstRate        Decimal @default(18.00) @map("gst_rate") @db.Decimal(5, 2)
  gstAmount      Decimal @default(0.00) @map("gst_amount") @db.Decimal(12, 2)
  cgstAmount     Decimal @default(0.00) @map("cgst_amount") @db.Decimal(12, 2)
  sgstAmount     Decimal @default(0.00) @map("sgst_amount") @db.Decimal(12, 2)
  igstAmount     Decimal @default(0.00) @map("igst_amount") @db.Decimal(12, 2)
  cessRate       Decimal @default(0.00) @map("cess_rate") @db.Decimal(5, 2)
  cessAmount     Decimal @default(0.00) @map("cess_amount") @db.Decimal(12, 2)
  totalAmount    Decimal @default(0.00) @map("total_amount") @db.Decimal(12, 2)
  batchNumber    String?  @map("batch_number") @db.VarChar(50)
  expiryDate     DateTime? @map("expiry_date") @db.Date
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  invoice SalesInvoice @relation(fields: [invoiceId], references: [id])
  product Product      @relation(fields: [productId], references: [id])

  @@map("sales_invoice_items")
}

// Purchase Invoices table
model PurchaseInvoice {
  id                String              @id @default(uuid()) @db.Uuid
  companyId         String              @map("company_id") @db.Uuid
  invoiceNumber     String              @map("invoice_number") @db.VarChar(50)
  invoiceDate       DateTime            @map("invoice_date") @db.Date
  dueDate           DateTime?           @map("due_date") @db.Date
  vendorId          String              @map("vendor_id") @db.Uuid
  vendorGstin       String?             @map("vendor_gstin") @db.VarChar(15)
  billingAddress    String?             @map("billing_address") @db.Text
  shippingAddress   String?             @map("shipping_address") @db.Text
  placeOfSupply     String?             @map("place_of_supply") @db.VarChar(100)
  invoiceType       String              @default("TAX_INVOICE") @map("invoice_type") @db.VarChar(20)
  paymentStatus     String              @default("PENDING") @map("payment_status") @db.VarChar(20)
  subtotal          Decimal             @default(0.00) @db.Decimal(12, 2)
  discountAmount    Decimal             @default(0.00) @map("discount_amount") @db.Decimal(12, 2)
  taxAmount         Decimal             @default(0.00) @map("tax_amount") @db.Decimal(12, 2)
  totalAmount       Decimal             @default(0.00) @map("total_amount") @db.Decimal(12, 2)
  roundOff          Decimal             @default(0.00) @map("round_off") @db.Decimal(12, 2)
  grandTotal        Decimal             @default(0.00) @map("grand_total") @db.Decimal(12, 2)
  cgstAmount        Decimal             @default(0.00) @map("cgst_amount") @db.Decimal(12, 2)
  sgstAmount        Decimal             @default(0.00) @map("sgst_amount") @db.Decimal(12, 2)
  igstAmount        Decimal             @default(0.00) @map("igst_amount") @db.Decimal(12, 2)
  cessAmount        Decimal             @default(0.00) @map("cess_amount") @db.Decimal(12, 2)
  isCancelled       Boolean             @default(false) @map("is_cancelled")
  cancelledAt       DateTime?           @map("cancelled_at") @db.Timestamp(6)
  cancelledBy       String?             @map("cancelled_by") @db.Uuid
  cancellationReason String?            @map("cancellation_reason") @db.Text
  notes             String?             @db.Text
  termsAndConditions String?            @map("terms_and_conditions") @db.Text
  createdAt         DateTime            @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt         DateTime            @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy         String?             @map("created_by") @db.Uuid
  updatedBy         String?             @map("updated_by") @db.Uuid

  company             Company              @relation(fields: [companyId], references: [id])
  vendor              Vendor               @relation(fields: [vendorId], references: [id])
  purchaseInvoiceItems PurchaseInvoiceItem[]
  invoicePayments     InvoicePayment[]

  @@unique([invoiceNumber, companyId], name: "uk_purchase_invoices_number_company")
  @@map("purchase_invoices")
}

// Purchase Invoice Items table
model PurchaseInvoiceItem {
  id             String   @id @default(uuid()) @db.Uuid
  invoiceId      String   @map("invoice_id") @db.Uuid
  productId      String   @map("product_id") @db.Uuid
  hsnCode        String?  @map("hsn_code") @db.VarChar(8)
  description    String?  @db.Text
  quantity       Decimal  @db.Decimal(10, 3)
  unit           String   @default("PCS") @db.VarChar(20)
  unitPrice      Decimal  @map("unit_price") @db.Decimal(12, 2)
  discountPercent Decimal @default(0.00) @map("discount_percent") @db.Decimal(5, 2)
  discountAmount Decimal @default(0.00) @map("discount_amount") @db.Decimal(12, 2)
  taxableAmount  Decimal @default(0.00) @map("taxable_amount") @db.Decimal(12, 2)
  gstRate        Decimal @default(18.00) @map("gst_rate") @db.Decimal(5, 2)
  gstAmount      Decimal @default(0.00) @map("gst_amount") @db.Decimal(12, 2)
  cgstAmount     Decimal @default(0.00) @map("cgst_amount") @db.Decimal(12, 2)
  sgstAmount     Decimal @default(0.00) @map("sgst_amount") @db.Decimal(12, 2)
  igstAmount     Decimal @default(0.00) @map("igst_amount") @db.Decimal(12, 2)
  cessRate       Decimal @default(0.00) @map("cess_rate") @db.Decimal(5, 2)
  cessAmount     Decimal @default(0.00) @map("cess_amount") @db.Decimal(12, 2)
  totalAmount    Decimal @default(0.00) @map("total_amount") @db.Decimal(12, 2)
  batchNumber    String?  @map("batch_number") @db.VarChar(50)
  expiryDate     DateTime? @map("expiry_date") @db.Date
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  invoice PurchaseInvoice @relation(fields: [invoiceId], references: [id])
  product Product         @relation(fields: [productId], references: [id])

  @@map("purchase_invoice_items")
}

// Customer Payments table
model CustomerPayment {
  id              String   @id @default(uuid()) @db.Uuid
  companyId       String   @map("company_id") @db.Uuid
  paymentNumber   String   @map("payment_number") @db.VarChar(50)
  paymentDate     DateTime @map("payment_date") @db.Date
  customerId      String   @map("customer_id") @db.Uuid
  paymentMethod   String   @map("payment_method") @db.VarChar(20)
  paymentReference String? @map("payment_reference") @db.VarChar(100)
  bankName        String?  @map("bank_name") @db.VarChar(100)
  chequeNumber    String?  @map("cheque_number") @db.VarChar(50)
  amount          Decimal  @db.Decimal(12, 2)
  narration       String?  @db.Text
  isReconciled    Boolean  @default(false) @map("is_reconciled")
  reconciledAt    DateTime? @map("reconciled_at") @db.Timestamp(6)
  reconciledBy    String?  @map("reconciled_by") @db.Uuid
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy       String?  @map("created_by") @db.Uuid
  updatedBy       String?  @map("updated_by") @db.Uuid

  company         Company  @relation(fields: [companyId], references: [id])
  customer        Customer @relation(fields: [customerId], references: [id])
  invoicePayments InvoicePayment[]

  @@unique([paymentNumber, companyId], name: "uk_customer_payments_number_company")
  @@map("customer_payments")
}

// Vendor Payments table
model VendorPayment {
  id              String   @id @default(uuid()) @db.Uuid
  companyId       String   @map("company_id") @db.Uuid
  paymentNumber   String   @map("payment_number") @db.VarChar(50)
  paymentDate     DateTime @map("payment_date") @db.Date
  vendorId        String   @map("vendor_id") @db.Uuid
  paymentMethod   String   @map("payment_method") @db.VarChar(20)
  paymentReference String? @map("payment_reference") @db.VarChar(100)
  bankName        String?  @map("bank_name") @db.VarChar(100)
  chequeNumber    String?  @map("cheque_number") @db.VarChar(50)
  amount          Decimal  @db.Decimal(12, 2)
  narration       String?  @db.Text
  isReconciled    Boolean  @default(false) @map("is_reconciled")
  reconciledAt    DateTime? @map("reconciled_at") @db.Timestamp(6)
  reconciledBy    String?  @map("reconciled_by") @db.Uuid
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt       DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy       String?  @map("created_by") @db.Uuid
  updatedBy       String?  @map("updated_by") @db.Uuid

  company         Company @relation(fields: [companyId], references: [id])
  vendor          Vendor  @relation(fields: [vendorId], references: [id])
  invoicePayments InvoicePayment[]

  @@unique([paymentNumber, companyId], name: "uk_vendor_payments_number_company")
  @@map("vendor_payments")
}

// Invoice Payments mapping table
model InvoicePayment {
  id          String   @id @default(uuid()) @db.Uuid
  invoiceType String   @map("invoice_type") @db.VarChar(10)
  invoiceId   String   @map("invoice_id") @db.Uuid
  paymentId   String   @map("payment_id") @db.Uuid
  companyId   String   @map("company_id") @db.Uuid
  amount      Decimal  @db.Decimal(12, 2)
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  createdBy   String?  @map("created_by") @db.Uuid

  company        Company         @relation(fields: [companyId], references: [id])
  customerPayment CustomerPayment? @relation(fields: [paymentId], references: [id])
  vendorPayment   VendorPayment?   @relation(fields: [paymentId], references: [id])

  @@map("invoice_payments")
}

// GSTR-1 Summary table
model GSTR1Summary {
  id                   String   @id @default(uuid()) @db.Uuid
  companyId            String   @map("company_id") @db.Uuid
  financialYear        String   @map("financial_year") @db.VarChar(9)
  monthNumber          Int      @map("month_number")
  b2bInvoices          Int      @default(0) @map("b2b_invoices")
  b2bTaxableValue      Decimal  @default(0.00) @map("b2b_taxable_value") @db.Decimal(12, 2)
  b2bIgstAmount        Decimal  @default(0.00) @map("b2b_igst_amount") @db.Decimal(12, 2)
  b2bCgstAmount        Decimal  @default(0.00) @map("b2b_cgst_amount") @db.Decimal(12, 2)
  b2bSgstAmount        Decimal  @default(0.00) @map("b2b_sgst_amount") @db.Decimal(12, 2)
  b2bCessAmount        Decimal  @default(0.00) @map("b2b_cess_amount") @db.Decimal(12, 2)
  b2cLargeInvoices     Int      @default(0) @map("b2c_large_invoices")
  b2cLargeTaxableValue Decimal  @default(0.00) @map("b2c_large_taxable_value") @db.Decimal(12, 2)
  b2cLargeIgstAmount   Decimal  @default(0.00) @map("b2c_large_igst_amount") @db.Decimal(12, 2)
  b2cLargeCgstAmount   Decimal  @default(0.00) @map("b2c_large_cgst_amount") @db.Decimal(12, 2)
  b2cLargeSgstAmount   Decimal  @default(0.00) @map("b2c_large_sgst_amount") @db.Decimal(12, 2)
  b2cSmallInvoices     Int      @default(0) @map("b2c_small_invoices")
  b2cSmallTaxableValue Decimal  @default(0.00) @map("b2c_small_taxable_value") @db.Decimal(12, 2)
  totalTaxableValue    Decimal  @default(0.00) @map("total_taxable_value") @db.Decimal(12, 2)
  totalIgstAmount      Decimal  @default(0.00) @map("total_igst_amount") @db.Decimal(12, 2)
  totalCgstAmount      Decimal  @default(0.00) @map("total_cgst_amount") @db.Decimal(12, 2)
  totalSgstAmount      Decimal  @default(0.00) @map("total_sgst_amount") @db.Decimal(12, 2)
  totalCessAmount      Decimal  @default(0.00) @map("total_cess_amount") @db.Decimal(12, 2)
  totalInvoiceValue    Decimal  @default(0.00) @map("total_invoice_value") @db.Decimal(12, 2)
  isFiled              Boolean  @default(false) @map("is_filed")
  filedAt              DateTime? @map("filed_at") @db.Timestamp(6)
  filedBy              String?  @map("filed_by") @db.Uuid
  createdAt            DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt            DateTime @updatedAt @map("updated_at") @db.Timestamp(6)
  createdBy            String?  @map("created_by") @db.Uuid
  updatedBy            String?  @map("updated_by") @db.Uuid

  company Company @relation(fields: [companyId], references: [id])

  @@unique([companyId, financialYear, monthNumber], name: "uk_gstr1_summary_company_year_month")
  @@map("gstr1_summary")
}
