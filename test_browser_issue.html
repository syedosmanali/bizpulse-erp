<!DOCTYPE html>
<html>
<head>
    <title>Sales Filter Browser Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .result { background: #e8f5e8; padding: 10px; margin: 5px 0; border-radius: 3px; }
        .error { background: #ffe8e8; padding: 10px; margin: 5px 0; border-radius: 3px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîç Sales Filter Browser Test</h1>
    <p><strong>Expected Result:</strong> Today should show 1 sale (Tea ‚Çπ800)</p>
    
    <div class="test">
        <h3>Step 1: Check Current Date</h3>
        <div id="dateCheck"></div>
    </div>
    
    <div class="test">
        <h3>Step 2: Test API Connection</h3>
        <button onclick="testAPI()">Test Sales API</button>
        <div id="apiTest"></div>
    </div>
    
    <div class="test">
        <h3>Step 3: Test Filtering Logic</h3>
        <button onclick="testFiltering()">Test Today Filter</button>
        <div id="filterTest"></div>
    </div>
    
    <div class="test">
        <h3>Step 4: Go to Sales Management</h3>
        <button onclick="window.location.href='/sales-management'">Open Sales Management</button>
        <p><small>Look for "(Fixed v2.0 - Today: 1 sale)" in title</small></p>
    </div>
    
    <script>
        // Step 1: Check current date
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        
        document.getElementById('dateCheck').innerHTML = `
            <div class="result">
                <strong>JavaScript Date:</strong> ${todayStr}<br>
                <strong>Full Date:</strong> ${today}<br>
                <strong>Expected:</strong> 2025-12-19
            </div>
        `;
        
        // Step 2: Test API
        async function testAPI() {
            try {
                console.log('üîç Testing API...');
                const response = await fetch('/api/sales?per_page=100');
                const data = await response.json();
                const sales = data.sales || data;
                
                // Find today's sales
                const todaySales = sales.filter(sale => {
                    const saleDate = sale.sale_date ? sale.sale_date.split(' ')[0] : '';
                    return saleDate === todayStr;
                });
                
                document.getElementById('apiTest').innerHTML = `
                    <div class="result">
                        <strong>API Response:</strong> ‚úÖ Success<br>
                        <strong>Total Sales:</strong> ${sales.length}<br>
                        <strong>Today's Sales:</strong> ${todaySales.length}<br>
                        <strong>Today's Products:</strong> ${todaySales.map(s => s.product_name).join(', ') || 'None'}<br>
                        <strong>Today's Total:</strong> ‚Çπ${todaySales.reduce((sum, s) => sum + (s.total_price || 0), 0)}
                    </div>
                `;
                
                // Store for filtering test
                window.testSales = sales;
                
            } catch (error) {
                document.getElementById('apiTest').innerHTML = `
                    <div class="error">‚ùå API Error: ${error.message}</div>
                `;
            }
        }
        
        // Step 3: Test filtering
        function testFiltering() {
            if (!window.testSales) {
                document.getElementById('filterTest').innerHTML = `
                    <div class="error">‚ùå Run API test first</div>
                `;
                return;
            }
            
            console.log('üîç Testing filtering logic...');
            
            // Apply exact same logic as sales management page
            const filteredSales = window.testSales.filter(sale => {
                const saleDate = sale.sale_date ? sale.sale_date.split(' ')[0] : '';
                const matches = saleDate === todayStr;
                console.log(`   ${saleDate} === ${todayStr} ? ${matches}`);
                return matches;
            });
            
            document.getElementById('filterTest').innerHTML = `
                <div class="result">
                    <strong>Filter Logic Test:</strong> ‚úÖ Complete<br>
                    <strong>Target Date:</strong> ${todayStr}<br>
                    <strong>Filtered Count:</strong> ${filteredSales.length}<br>
                    <strong>Filtered Products:</strong> ${filteredSales.map(s => s.product_name).join(', ') || 'None'}<br>
                    <strong>Expected:</strong> 1 sale (Tea 250g)
                </div>
            `;
        }
        
        // Auto-run date check
        console.log('üöÄ Browser test loaded');
        console.log('üìÖ Current date:', todayStr);
    </script>
</body>
</html>